<!--pages/activity/detail.wxml-->
<view class="container">
  <!-- èƒŒæ™¯è£…é¥° -->
  <view class="bg-decoration">
    <image class="bg-image" src="/images/lcw.jpg" mode="aspectFill" />
    <view class="bg-overlay"></view>
  </view>

  <!-- æ´»åŠ¨ä¿¡æ¯å¡ç‰‡ -->
  <view class="activity-info-card card">
    <view class="activity-title text-title">{{activity.title}}</view>
    
    <view class="activity-meta">
      <view class="meta-item">
        <text class="meta-icon">ğŸ•</text>
        <view class="meta-content">
          <text class="meta-label">æ´»åŠ¨æ—¶é—´</text>
          <text class="meta-value">{{activity.date}} {{activity.time}}</text>
        </view>
      </view>
      
      <view class="meta-item">
        <text class="meta-icon">ğŸ“</text>
        <view class="meta-content">
          <text class="meta-label">æ´»åŠ¨åœ°ç‚¹</text>
          <text class="meta-value">{{activity.location}}</text>
        </view>
      </view>
      
      <view class="meta-item" wx:if="{{activity.rules}}">
        <text class="meta-icon">ğŸ“‹</text>
        <view class="meta-content">
          <text class="meta-label">æ´»åŠ¨è§„åˆ™</text>
          <text class="meta-value">{{activity.rules}}</text>
        </view>
      </view>
      
      <view class="meta-item" wx:if="{{activity.notes}}">
        <text class="meta-icon">ğŸ“</text>
        <view class="meta-content">
          <text class="meta-label">å¤‡æ³¨è¯´æ˜</text>
          <text class="meta-value">{{activity.notes}}</text>
        </view>
      </view>
      
      <view class="meta-item" wx:if="{{activity.cancelDeadline}}">
        <text class="meta-icon">â°</text>
        <view class="meta-content">
          <text class="meta-label">æœ€æ™šå–æ¶ˆæ—¶é—´</text>
          <text class="meta-value">{{activity.cancelDeadline}}</text>
        </view>
      </view>
    </view>

    <!-- æ´»åŠ¨æè¿° -->
    <view class="activity-description" wx:if="{{activity.description}}">
      <view class="description-header">
        <text class="description-title text-subtitle">æ´»åŠ¨æè¿°</text>
      </view>
      <view class="description-content">
        <text class="description-text text-body">{{activity.description}}</text>
      </view>
    </view>

    <!-- æŠ¥åç»Ÿè®¡ -->
    <view class="join-stats">
      <view class="stats-item">
        <text class="stats-number">{{activity.joinedCount}}</text>
        <text class="stats-label">å·²æŠ¥å</text>
      </view>
      <view class="stats-item" wx:if="{{activity.maxCount}}">
        <text class="stats-number">{{activity.maxCount}}</text>
        <text class="stats-label">æ€»åé¢</text>
      </view>
      <view class="stats-item">
        <text class="stats-number">{{activity.status === 'active' ? 'è¿›è¡Œä¸­' : activity.status === 'full' ? 'å·²æ»¡å‘˜' : 'å·²ç»“æŸ'}}</text>
        <text class="stats-label">æ´»åŠ¨çŠ¶æ€</text>
      </view>
    </view>

    <!-- è¿›åº¦æ¡ -->
    <view class="progress-section" wx:if="{{activity.maxCount}}">
      <view class="progress-info">
        <text class="text-body">æŠ¥åè¿›åº¦</text>
        <text class="text-caption">{{activity.joinedCount}}/{{activity.maxCount}} äºº</text>
      </view>
      <view class="progress-bar">
        <view class="progress-fill" style="width: {{(activity.joinedCount / activity.maxCount * 100)}}%"></view>
      </view>
    </view>
  </view>

  <!-- æŠ¥ååˆ—è¡¨ -->
  <view class="joiners-section card">
    <view class="section-header">
      <text class="section-title text-subtitle">æŠ¥ååˆ—è¡¨</text>
      <text class="section-count text-caption">({{activity.joinedCount}}äºº)</text>
    </view>
    
    <view wx:if="{{joiners.length === 0}}" class="empty-joiners">
      <text class="text-caption">æš‚æ— æŠ¥å</text>
    </view>
    
    <view wx:else class="joiners-list">
      <view wx:for="{{joiners}}" wx:key="id" class="joiner-item">
        <image class="avatar" src="{{item.userAvatar || '/images/default-avatar.png'}}" />
        <view class="joiner-info">
          <text class="joiner-name text-body">{{item.name}}</text>
          <text class="join-time text-caption">{{item.joinTime}}</text>
          <view class="joiner-message" wx:if="{{item.message}}">
            <text class="message-text text-caption">ğŸ’¬ {{item.message}}</text>
          </view>
        </view>
        <view class="joiner-contact" wx:if="{{item.contact}}">
          <text class="contact-text text-caption">ğŸ“ {{item.contact}}</text>
        </view>
      </view>
    </view>
  </view>

  <!-- è¯„è®ºåŒº -->
  <view class="comments-section card">
    <view class="section-header">
      <text class="section-title text-subtitle">è¯„è®ºåŒº</text>
      <text class="section-count text-caption">({{comments.length}}æ¡)</text>
    </view>
    
    <!-- è¯„è®ºè¾“å…¥æ¡† -->
    <view class="comment-input">
      <input 
        class="comment-field" 
        placeholder="è¯´ç‚¹ä»€ä¹ˆ..." 
        value="{{commentText}}"
        bindinput="onCommentInput"
        maxlength="200"
      />
      <button 
        class="btn btn-primary comment-btn" 
        bindtap="onSubmitComment"
        disabled="{{!commentText.trim()}}"
      >
        å‘é€
      </button>
    </view>
    
    <!-- è¯„è®ºåˆ—è¡¨ -->
    <view wx:if="{{comments.length === 0}}" class="empty-comments">
      <text class="text-caption">æš‚æ— è¯„è®º</text>
    </view>
    
    <view wx:else class="comments-list">
      <view wx:for="{{comments}}" wx:key="id" class="comment-item">
        <image class="avatar avatar-small" src="{{item.avatar || '/images/default-avatar.png'}}" />
        <view class="comment-content">
          <view class="comment-header">
            <text class="comment-author text-body">{{item.author}}</text>
            <text class="comment-time text-caption">{{item.time}}</text>
          </view>
          <text class="comment-text text-body">{{item.content}}</text>
        </view>
      </view>
    </view>
  </view>

  <!-- åº•éƒ¨æ“ä½œæ  -->
  <view class="bottom-actions">
    <button 
      wx:if="{{!hasJoined && activity.status === 'active'}}"
      class="btn btn-primary action-btn" 
      bindtap="onJoinActivity"
    >
      æˆ‘è¦æŠ¥å
    </button>
    <button 
      wx:elif="{{hasJoined}}"
      class="btn btn-outline action-btn" 
      bindtap="onCancelJoin"
    >
      å–æ¶ˆæŠ¥å
    </button>
    <view wx:if="{{hasJoined && activity.cancelDeadline}}" class="cancel-deadline-info">
      <text class="deadline-text">æœ€æ™šå–æ¶ˆæ—¶é—´ï¼š{{activity.cancelDeadline}}</text>
    </view>
    <button 
      wx:else
      class="btn btn-disabled action-btn" 
      disabled
    >
      {{activity.status === 'full' ? 'å·²æ»¡å‘˜' : 'æ´»åŠ¨å·²ç»“æŸ'}}
    </button>
  </view>
</view>
