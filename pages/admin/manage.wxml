<!--pages/admin/manage.wxml-->
<view class="container">
  <!-- ç®¡ç†å‘˜æƒé™æ£€æŸ¥ -->
  <view wx:if="{{!isAdmin}}" class="permission-denied">
    <text class="denied-icon">ğŸ”’</text>
    <text class="denied-title text-title">éœ€è¦ç®¡ç†å‘˜æƒé™</text>
    <text class="denied-desc text-body">è¯·è”ç³»ç®¡ç†å‘˜è·å–æƒé™</text>
    <button class="btn btn-primary" bindtap="onGoBack">è¿”å›</button>
  </view>

  <!-- ç®¡ç†å‘˜ç•Œé¢ -->
  <view wx:else class="admin-content">
    <!-- ç»Ÿè®¡æ¦‚è§ˆ -->
    <view class="stats-overview card">
      <view class="overview-title text-subtitle">æ•°æ®æ¦‚è§ˆ</view>
      <view class="overview-stats">
        <view class="overview-item">
          <text class="overview-number">{{overviewStats.totalActivities}}</text>
          <text class="overview-label">æ€»æ´»åŠ¨æ•°</text>
        </view>
        <view class="overview-item">
          <text class="overview-number">{{overviewStats.totalJoins}}</text>
          <text class="overview-label">æ€»æŠ¥åæ•°</text>
        </view>
        <view class="overview-item">
          <text class="overview-number">{{overviewStats.activeActivities}}</text>
          <text class="overview-label">è¿›è¡Œä¸­</text>
        </view>
      </view>
    </view>

    <!-- ç®¡ç†åŠŸèƒ½ -->
    <view class="manage-functions card">
      <view class="section-title text-subtitle">ç®¡ç†åŠŸèƒ½</view>
      <view class="function-grid">
        <view class="function-item" bindtap="onCreateActivity">
          <view class="function-icon">â•</view>
          <text class="function-name">å‘å¸ƒæ´»åŠ¨</text>
        </view>
        <view class="function-item" bindtap="onUserManagement">
          <view class="function-icon">ğŸ‘¥</view>
          <text class="function-name">ç”¨æˆ·ç®¡ç†</text>
        </view>
        <view class="function-item" bindtap="onSystemSettings">
          <view class="function-icon">âš™ï¸</view>
          <text class="function-name">ç³»ç»Ÿè®¾ç½®</text>
        </view>
        <view class="function-item" bindtap="onDataExport">
          <view class="function-icon">ğŸ“Š</view>
          <text class="function-name">æ•°æ®å¯¼å‡º</text>
        </view>
      </view>
    </view>

    <!-- æ´»åŠ¨ç®¡ç† -->
    <view class="activities-section card">
      <view class="section-header">
        <text class="section-title text-subtitle">æ´»åŠ¨ç®¡ç†</text>
        <button class="btn btn-primary create-btn" bindtap="onCreateActivity">
          + å‘å¸ƒæ´»åŠ¨
        </button>
      </view>

      <!-- ç­›é€‰æ ‡ç­¾ -->
      <view class="filter-tabs">
        <view 
          wx:for="{{filterTabs}}" 
          wx:key="key"
          class="filter-tab {{currentFilter === item.key ? 'active' : ''}}"
          bindtap="onFilterChange"
          data-filter="{{item.key}}"
        >
          {{item.label}}
        </view>
      </view>

      <!-- æ´»åŠ¨åˆ—è¡¨ -->
      <view class="activities-list">
        <view wx:if="{{filteredActivities.length === 0}}" class="empty-activities">
          <text class="empty-icon">ğŸ“</text>
          <text class="empty-text text-body">æš‚æ— æ´»åŠ¨</text>
          <text class="empty-desc text-caption">ç‚¹å‡»ä¸Šæ–¹æŒ‰é’®å‘å¸ƒç¬¬ä¸€ä¸ªæ´»åŠ¨</text>
        </view>

        <view wx:else>
          <view 
            wx:for="{{filteredActivities}}" 
            wx:key="id" 
            class="activity-item"
            bindtap="onActivityTap"
            data-id="{{item.id}}"
          >
            <view class="activity-header">
              <text class="activity-title text-body">{{item.title}}</text>
              <view class="activity-status status-tag {{item.status === 'active' ? 'status-active' : item.status === 'full' ? 'status-full' : 'status-ended'}}">
                {{item.status === 'active' ? 'è¿›è¡Œä¸­' : item.status === 'full' ? 'å·²æ»¡å‘˜' : 'å·²ç»“æŸ'}}
              </view>
            </view>
            
            <view class="activity-meta">
              <text class="meta-text">ğŸ• {{item.date}} {{item.time}}</text>
              <text class="meta-text">ğŸ“ {{item.location}}</text>
              <text class="meta-text">ğŸ‘¥ {{item.joinedCount}}/{{item.maxCount || 'ä¸é™'}} äºº</text>
            </view>

            <view class="activity-actions">
              <button class="btn btn-outline action-btn" bindtap="onEditActivity" data-id="{{item.id}}" catchtap="true">
                ç¼–è¾‘
              </button>
              <button class="btn btn-outline action-btn" bindtap="onViewJoins" data-id="{{item.id}}" catchtap="true">
                æŸ¥çœ‹æŠ¥å
              </button>
              <button class="btn btn-outline action-btn danger" bindtap="onDeleteActivity" data-id="{{item.id}}" catchtap="true">
                åˆ é™¤
              </button>
            </view>
          </view>
        </view>
      </view>
    </view>
  </view>
</view>
