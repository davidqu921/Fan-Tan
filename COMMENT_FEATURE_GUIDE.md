# 活动评论功能使用指南

## 功能概述

已为活动详情页面添加了完整的评论功能，支持已登录的管理员和用户进行留言交流。

## 主要功能

### 1. 发送评论
- **权限要求**: 需要登录
- **操作步骤**:
  1. 进入活动详情页面
  2. 在评论区输入框输入评论内容
  3. 点击"发送"按钮
  4. 评论将实时保存到Firebase数据库

### 2. 查看评论
- **显示内容**:
  - 评论者头像和昵称
  - 管理员标识（蓝色徽章）
  - 评论内容和时间
  - 删除按钮（仅对本人或管理员可见）

### 3. 删除评论
- **权限要求**: 
  - 评论作者本人
  - 管理员（可删除任何评论）
- **操作步骤**:
  1. 点击评论右侧的删除按钮（🗑️）
  2. 确认删除操作
  3. 评论将从数据库和界面中移除

## 技术实现

### 数据结构
```javascript
{
  id: "评论ID",
  activityId: "活动ID", 
  author: "评论者昵称",
  authorId: "评论者用户ID",
  avatar: "评论者头像URL",
  content: "评论内容",
  isAdmin: "是否为管理员",
  createdAt: "创建时间",
  updatedAt: "更新时间"
}
```

### 数据库集合
- **集合名称**: `comments`
- **索引**: 按 `activityId` 和 `createdAt` 排序
- **权限规则**: 认证用户可读，作者可写

### 文件修改
1. `utils/activityService.js` - 添加评论CRUD操作
2. `pages/activity/detail.js` - 集成评论功能逻辑
3. `pages/activity/detail.wxml` - 更新评论界面
4. `pages/activity/detail.wxss` - 添加评论样式
5. `firestore.rules` - 更新数据库权限规则

## 使用注意事项

1. **登录状态**: 评论功能需要用户登录，未登录用户会提示"请先登录"
2. **内容限制**: 评论内容最大200字符
3. **实时更新**: 评论发送后会自动刷新列表显示最新内容
4. **权限控制**: 只有评论作者和管理员可以删除评论
5. **管理员标识**: 管理员发布的评论会显示蓝色"管理员"徽章

## 测试建议

1. 使用不同角色用户（普通用户、管理员）测试评论功能
2. 测试评论的发送、显示、删除功能
3. 验证权限控制是否正确
4. 检查评论列表的实时更新
5. 测试网络异常情况下的错误处理

## 后续优化建议

1. 添加评论点赞功能
2. 支持评论回复（嵌套评论）
3. 添加评论内容过滤和审核
4. 优化评论列表的加载性能
5. 添加评论通知功能
